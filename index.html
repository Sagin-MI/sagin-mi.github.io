<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Language" content="ja">
  <meta name="google" content="notranslate">  
  <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <title>DeepLink Test</title>
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="stylesheet" href="styles.css">
  <script>
    // App Store and Play Store URLs
    const appStoreUrl      = "https://apps.apple.com/app/6446269812";
    const playStoreUrl     = "https://play.google.com/store/apps/details?id=com.app.mulyankan";
    const webFallbackUrl   = "https://dev5.yigserver.com/apps/goatus/sys/post-detail/?id=51e6b6b6-4ce6-46c8-a6a0-ff93142f5a90";
    const androidIntentUrl = `intent://sagin-mi.github.io/#/post-detail?id=1#Intent;scheme=https;package=com.example.flutter_deeplink;S.browser_fallback_url=${encodeURIComponent(playStoreUrl)};end`;
    const iosIntentUrl     = "https://sagin-mi.github.io/#/post-detail?id=1";
    
    // Device type detection
    function isIOS() {
      const ios = /iPhone|iPad|iPod/i.test(navigator.userAgent);
      console.log("isIOS:", ios);
      return ios;
    }

    function isAndroid() {
      const android = /Android/i.test(navigator.userAgent);
      console.log("isAndroid:", android);
      return android;
    }

    function isDesktop() {
      const desktop = !isIOS() && !isAndroid();
      console.log("isDesktop:", desktop);
      return desktop;
    }

    // Handle redirection based on the device type
    function handleRedirect() {
      console.log("Handling redirect...");
      if (isIOS()) {
        console.log("Redirecting to iOS intent URL:", iosIntentUrl);
        redirectToUrlIOS("https://quotezark.dlofistudio.com/");
        // window.location.href = "https://quotezark.dlofistudio.com/";
        // window.location.href = iosIntentUrl;
        // setTimeout(() => {
        //   console.log("Fallback to App Store:", appStoreUrl);
        //   window.location.href = appStoreUrl;
        // }, 1500);
      } else if (isAndroid()) {
        console.log("Redirecting to Android intent URL:", androidIntentUrl);
        window.location.href = androidIntentUrl;
      } else {
        console.log("Redirecting to web fallback URL currently not redirect for testing :", webFallbackUrl);
        // window.location.href = webFallbackUrl;
      }
    }

    function redirectToUrlIOS(url) {
      const anchor = document.createElement("a");
      anchor.href = url;
      anchor.target = "_self"; // Ensures it opens in the current tab
      anchor.click();
    }

    // Automatically redirect when the page loads
    window.onload = () => {
      console.log("Page loaded. Initiating redirect...");
      handleRedirect();
    };
  </script>
</head>
<body>
  <app-root>
    <router-outlet></router-outlet>
    <!-- Button to explicitly open the app -->
    <a target="_blank" class="btn btn-dark" href="#" onclick="handleRedirect(); return false;">
      Open In App
    </a>
  </app-root>
  <script src="polyfills.js" type="module"></script>
  <script src="main.js" type="module"></script>
</body>
</html>
